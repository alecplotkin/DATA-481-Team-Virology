---
title: "Lung Cancer Dataset Analysis"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
#library(dplyr)
#library(tidyr)
library(FactoMineR)
library(factoextra)
library(devtools)
library(corrplot)
library(PerformanceAnalytics)
library(Rtsne)
library(umap)
library(reshape2)
```

# Description of dataset 
This synthetic dataset simulates real-world lung cancer cases, including demographics, medical history, treatments, and outcomes. It supports predictive modeling, prognosis assessment, and treatment analysis in research.

# Question of Interest
How can patient demographics, medical history, tumor characteristics, and treatment details predict the stage of lung cancer at diagnosis? And how patients cluster by stage?

```{r}
cnrdata <- read.csv("lung_cancer_data.csv")
head(cnrdata)
summary(cnrdata)
```

```{r}
# Select numeric predictors and the target variable (Stage)
cnrdata$Stage <- as.numeric(factor(cnrdata$Stage, levels = c("Stage I", "Stage II", "Stage III", "Stage IV")))

numeric_data <- cnrdata %>% 
  select(where(is.numeric))

summary(numeric_data)
```

```{r}
#The correlation between variables
cor.mat = cor(numeric_data, use = "complete.obs")

```

```{r}
# Heat map showing correlation between variables

melted_cor_mat = melt(cor.mat)

ggplot(data = melted_cor_mat, aes(x=Var1, y=Var2, fill=value)) + 
geom_tile()+
theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1, size = 10))
```

```{r, warning = FALSE}
chart.Correlation(numeric_data[, 1:6], histogram=TRUE, pch=19)
```
```{r}
# Perform PCA
PCA(numeric_data, scale.unit = TRUE, ncp = 5, graph = TRUE)
```
```{r}
res.pca <- PCA(numeric_data, graph = FALSE)
print(res.pca)
```

```{r}
eigenvalues <- res.pca$eig
head(eigenvalues[, 1:2])
```
```{r}
#pca_result <- PCA(numeric_data, graph = FALSE)
fviz_eig(pca_result, addlabels = TRUE, ylim = c(0, 50))
```
Figure 1: Scree plot displaying the percentage of variance explained by each principal component. The gradual decline in variance indicates that no single component dominates the dataset, suggesting that multiple components contribute meaningfully to the overall variance. This plot helps determine the number of components to retain for further analysis.
```{r}
cnrdata$Stage <- as.factor(cnrdata$Stage)
numeric_data <- na.omit(numeric_data)

# PCA Individual Plot
fviz_pca_ind(
  pca_result,
  geom.ind = "point",             # Show points for individuals
  col.ind = cnrdata$Stage,        # Color individuals by Stage
  palette = "jco",                # Use journal color palette
  addEllipses = TRUE,             # Add confidence ellipses
  ellipse.level = 0.95,           # Confidence level for ellipses
  label = "none",                 # Remove labels for individuals
  title = "PCA: Individuals Colored by Stage"
) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```
Figure 2: Principal Component Analysis (PCA) plot showing the distribution of individuals across the first two principal components. Points are colored by cancer stage (Stage I-IV), highlighting the clustering patterns based on the input variables such as age, performance status, and tumor size.


#Discussion:
Based on the observation that there is no clear clustering in the PCA plot and the variables used are insufficient to differentiate between stages. Adding new variables, like genetic markers or imaging features, will make it easier to separate lung cancer stages. This should result in clearer clustering when using PCA or similar methods

